# Multi-Document Search Engine - Visual System Diagram

## ğŸ¨ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                                                                 â”‚
â”‚  query_documents("Your question")                              â”‚
â”‚            OR                                                   â”‚
â”‚  query_specific_type("Your question", "pdf")                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-ROUTE CHAIN                            â”‚
â”‚                   (Orchestrator Layer)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ROUTER CHAIN                               â”‚
â”‚                   (LLM-Based Router)                            â”‚
â”‚                                                                 â”‚
â”‚  Analyzes query â†’ Determines document type                     â”‚
â”‚                                                                 â”‚
â”‚  "sales data" â†’ CSV                                            â”‚
â”‚  "report findings" â†’ PDF                                       â”‚
â”‚  "meeting notes" â†’ DOCX                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚               â”‚               â”‚
            â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PDF Chain   â”‚ â”‚ DOCX Chain  â”‚ â”‚ CSV Chain   â”‚
    â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
    â”‚ RetrievalQA â”‚ â”‚ RetrievalQA â”‚ â”‚ RetrievalQA â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PDF Retrieverâ”‚ â”‚DOCX Retrieverâ”‚ â”‚CSV Retrieverâ”‚
    â”‚   (k=5)     â”‚ â”‚   (k=5)     â”‚ â”‚   (k=10)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PDF VectorDB â”‚ â”‚DOCX VectorDBâ”‚ â”‚CSV VectorDB â”‚
    â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
    â”‚DocArray     â”‚ â”‚DocArray     â”‚ â”‚DocArray     â”‚
    â”‚In-Memory    â”‚ â”‚In-Memory    â”‚ â”‚In-Memory    â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PDF Documentsâ”‚ â”‚Word Documentsâ”‚ â”‚CSV Files    â”‚
    â”‚  (*.pdf)    â”‚ â”‚  (*.docx)   â”‚ â”‚  (*.csv)    â”‚
    â”‚             â”‚ â”‚             â”‚ â”‚             â”‚
    â”‚ â€¢ Reports   â”‚ â”‚ â€¢ Memos     â”‚ â”‚ â€¢ Sales     â”‚
    â”‚ â€¢ Papers    â”‚ â”‚ â€¢ Letters   â”‚ â”‚ â€¢ Orders    â”‚
    â”‚ â€¢ Manuals   â”‚ â”‚ â€¢ Proposals â”‚ â”‚ â€¢ Data      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Query Flow Diagram

```
User Query: "What are the total sales for 2016?"
    â”‚
    â”‚ Step 1: Query received
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MultiRouteChain                     â”‚
â”‚ â€¢ Receives query                    â”‚
â”‚ â€¢ Passes to router                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 2: Route query
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLMRouterChain                      â”‚
â”‚ â€¢ Analyzes: "sales", "total"       â”‚
â”‚ â€¢ Classifies: Numerical/tabular    â”‚
â”‚ â€¢ Decision: Route to CSV           â”‚
â”‚ â€¢ Returns: {"destination": "csv"}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 3: Execute CSV chain
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSV QA Chain                        â”‚
â”‚ â€¢ Receives query                    â”‚
â”‚ â€¢ Requests retrieval                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 4: Retrieve docs
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSV Retriever                       â”‚
â”‚ â€¢ Embeds query                      â”‚
â”‚ â€¢ Similarity search                 â”‚
â”‚ â€¢ Returns top 10 matches            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 5: Get vectors
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CSV Vector Store                    â”‚
â”‚ â€¢ Searches embeddings               â”‚
â”‚ â€¢ Finds relevant rows               â”‚
â”‚ â€¢ Returns documents                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 6: Build context
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Context Builder                     â”‚
â”‚ â€¢ Formats retrieved docs            â”‚
â”‚ â€¢ Creates prompt with context       â”‚
â”‚ â€¢ Adds original question            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 7: LLM processing
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ChatOpenAI (via OpenRouter)        â”‚
â”‚ â€¢ Receives: question + context      â”‚
â”‚ â€¢ Processes with GPT model          â”‚
â”‚ â€¢ Generates natural language answer â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ Step 8: Return answer
             â–¼
Answer: "The total sales for 2016 were..."
```

## ğŸ—ï¸ Document Processing Pipeline

```
Document Files
    â”‚
    â”œâ”€ *.pdf files
    â”‚   â”‚
    â”‚   â–¼
    â”‚  PyPDFLoader
    â”‚   â”‚ â€¢ Extracts text per page
    â”‚   â”‚ â€¢ Preserves metadata
    â”‚   â”‚ â€¢ Creates Document objects
    â”‚   â–¼
    â”‚  PDF Documents
    â”‚   â”‚ [metadata: {source, page, doc_type: 'pdf'}]
    â”‚   â–¼
    â”‚  HuggingFace Embeddings
    â”‚   â”‚ â€¢ sentence-transformers/all-mpnet-base-v2
    â”‚   â”‚ â€¢ 768-dimensional vectors
    â”‚   â”‚ â€¢ Normalized for cosine similarity
    â”‚   â–¼
    â”‚  PDF Vector Store
    â”‚   â”‚ â€¢ DocArrayInMemorySearch
    â”‚   â”‚ â€¢ Indexed embeddings
    â”‚   â”‚ â€¢ Fast similarity search
    â”‚   â–¼
    â”‚  PDF Retriever (k=5)
    â”‚
    â”œâ”€ *.docx files
    â”‚   â”‚
    â”‚   â–¼
    â”‚  Docx2txtLoader
    â”‚   â”‚ â€¢ Extracts text content
    â”‚   â”‚ â€¢ Preserves structure
    â”‚   â”‚ â€¢ Creates Document objects
    â”‚   â–¼
    â”‚  DOCX Documents
    â”‚   â”‚ [metadata: {source, doc_type: 'docx'}]
    â”‚   â–¼
    â”‚  HuggingFace Embeddings
    â”‚   â”‚ â€¢ Same model as PDF
    â”‚   â”‚ â€¢ Consistent vector space
    â”‚   â–¼
    â”‚  DOCX Vector Store
    â”‚   â”‚ â€¢ DocArrayInMemorySearch
    â”‚   â”‚ â€¢ Separate from PDF store
    â”‚   â–¼
    â”‚  DOCX Retriever (k=5)
    â”‚
    â””â”€ *.csv files
        â”‚
        â–¼
       CSVLoader
        â”‚ â€¢ Parses CSV rows
        â”‚ â€¢ Each row = Document
        â”‚ â€¢ Includes all columns
        â–¼
       CSV Documents
        â”‚ [metadata: {source, row, doc_type: 'csv'}]
        â–¼
       HuggingFace Embeddings
        â”‚ â€¢ Embeds row content
        â”‚ â€¢ Captures relationships
        â–¼
       CSV Vector Store
        â”‚ â€¢ DocArrayInMemorySearch
        â”‚ â€¢ Optimized for tabular data
        â–¼
       CSV Retriever (k=10)
```

## ğŸ§  Router Decision Logic

```
                    User Query
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Analyze Keywords    â”‚
            â”‚                      â”‚
            â”‚ â€¢ sales, orders,     â”‚
            â”‚   data, numbers?     â”‚
            â”‚   â†’ CSV              â”‚
            â”‚                      â”‚
            â”‚ â€¢ report, findings,  â”‚
            â”‚   paper, study?      â”‚
            â”‚   â†’ PDF              â”‚
            â”‚                      â”‚
            â”‚ â€¢ memo, letter,      â”‚
            â”‚   meeting, action?   â”‚
            â”‚   â†’ DOCX             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Analyze Intent      â”‚
            â”‚                      â”‚
            â”‚ â€¢ Numerical analysis?â”‚
            â”‚   â†’ CSV              â”‚
            â”‚                      â”‚
            â”‚ â€¢ Summarization?     â”‚
            â”‚   â†’ PDF/DOCX         â”‚
            â”‚                      â”‚
            â”‚ â€¢ Data query?        â”‚
            â”‚   â†’ CSV              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  LLM Classification  â”‚
            â”‚                      â”‚
            â”‚  Returns JSON:       â”‚
            â”‚  {                   â”‚
            â”‚    "destination":    â”‚
            â”‚      "pdf"|"docx"|   â”‚
            â”‚      "csv",          â”‚
            â”‚    "next_inputs":    â”‚
            â”‚      "original query"â”‚
            â”‚  }                   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              Route to Destination
```

## ğŸ“Š Data Structures

### Document Object
```python
Document(
    page_content: str,      # The actual text
    metadata: {
        'source': str,       # File path
        'doc_type': str,     # 'pdf', 'docx', or 'csv'
        'page': int,         # (PDF only) Page number
        'row': int           # (CSV only) Row number
    }
)
```

### Vector Store Structure
```
VectorStore
â”œâ”€ documents: List[Document]
â”œâ”€ embeddings: List[Vector[768]]
â”œâ”€ index: SearchIndex
â””â”€ metadata: Dict
```

### QA Chain Structure
```
RetrievalQA
â”œâ”€ llm: ChatOpenAI
â”œâ”€ retriever: VectorStoreRetriever
â”œâ”€ chain_type: "stuff"
â”œâ”€ return_source_documents: True
â””â”€ verbose: True/False
```

## ğŸ”€ Component Interaction Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Layer   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ query_documents() / query_specific_type()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application Layer        â”‚
â”‚ â€¢ MultiRouteChain        â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ LLMRouterChain         â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚                           â”‚
       â”‚ Routes to...              â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Chain Layer              â”‚       â”‚
â”‚ â€¢ PDF QA Chain           â”‚       â”‚
â”‚ â€¢ DOCX QA Chain          â”‚       â”‚ Feedback loop
â”‚ â€¢ CSV QA Chain           â”‚       â”‚ for routing
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ decisions
       â”‚                           â”‚
       â”‚ Retrieves from...         â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Retrieval Layer          â”‚       â”‚
â”‚ â€¢ PDF Retriever          â”‚       â”‚
â”‚ â€¢ DOCX Retriever         â”‚       â”‚
â”‚ â€¢ CSV Retriever          â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚                           â”‚
       â”‚ Searches in...            â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Vector Store Layer       â”‚       â”‚
â”‚ â€¢ PDF VectorDB           â”‚       â”‚
â”‚ â€¢ DOCX VectorDB          â”‚       â”‚
â”‚ â€¢ CSV VectorDB           â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚                           â”‚
       â”‚ Contains...               â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Embedding Layer          â”‚       â”‚
â”‚ HuggingFace Embeddings   â”‚       â”‚
â”‚ (768-dim vectors)        â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
       â”‚                           â”‚
       â”‚ Represents...             â”‚
       â–¼                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ Data Layer               â”‚       â”‚
â”‚ â€¢ PDF Documents          â”‚       â”‚
â”‚ â€¢ DOCX Documents         â”‚       â”‚
â”‚ â€¢ CSV Documents          â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM Layer                â”‚
â”‚ ChatOpenAI (OpenRouter)  â”‚
â”‚ â€¢ Routing decisions      â”‚
â”‚ â€¢ Answer generation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Example: Complete Query Journey

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ INPUT: "What is the average sales amount in 2016?"     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Router Analysis                â”‚
        â”‚ Keywords: sales, amount, 2016  â”‚
        â”‚ Intent: Numerical calculation  â”‚
        â”‚ Decision: CSV                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CSV QA Chain                   â”‚
        â”‚ Receives query + retriever     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ CSV Retriever                  â”‚
        â”‚ Embeds query to 768-dim vector â”‚
        â”‚ Similarity search in CSV VectorDBâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Returns Top 10 Relevant Rows   â”‚
        â”‚ â€¢ Row 5: Sales=261.96, 2016... â”‚
        â”‚ â€¢ Row 12: Sales=731.94, 2016...â”‚
        â”‚ â€¢ Row 23: Sales=14.62, 2016... â”‚
        â”‚ â€¢ ... (7 more rows)            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Build Context                  â”‚
        â”‚ Format: "Based on: [rows...]"  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ LLM (ChatOpenAI)               â”‚
        â”‚ Prompt: Question + Context     â”‚
        â”‚ Process: Calculate average     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ OUTPUT: "The average sales amount in 2016 was $342.84, â”ƒ
â”ƒ calculated from 145 orders. The highest sale was       â”ƒ
â”ƒ $9,892.74 and the lowest was $2.99."                   â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
```

## ğŸ“ˆ Scalability Model

```
Single Document Type (Before)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Documents: 1 file
Vector Store: 1 store
QA Chain: 1 chain
Complexity: O(1)


Multi-Document Type (After)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Documents: N files per type Ã— 3 types
Vector Stores: 3 stores (isolated)
QA Chains: 3 chains
Router: 1 intelligent router
Complexity: O(3) = O(1) constant time
Routing Overhead: ~1-2 seconds per query


Extensible to:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Documents: N files per type Ã— M types
Vector Stores: M stores
QA Chains: M chains
Router: 1 router (handles M types)
Complexity: O(M) linear scaling
```

## ğŸ”§ Configuration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Configuration Layer                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â”œâ”€ Embeddings Model                    â”‚
â”‚ â”‚  â””â”€ sentence-transformers/all-mpnet â”‚
â”‚ â”‚                                       â”‚
â”‚ â”œâ”€ LLM Model                           â”‚
â”‚ â”‚  â””â”€ openai/gpt-oss-20b:free         â”‚
â”‚ â”‚                                       â”‚
â”‚ â”œâ”€ Retrieval Counts                    â”‚
â”‚ â”‚  â”œâ”€ PDF: k=5                         â”‚
â”‚ â”‚  â”œâ”€ DOCX: k=5                        â”‚
â”‚ â”‚  â””â”€ CSV: k=10                        â”‚
â”‚ â”‚                                       â”‚
â”‚ â”œâ”€ Chain Type                          â”‚
â”‚ â”‚  â””â”€ "stuff" (alternatives: map_reduce)â”‚
â”‚ â”‚                                       â”‚
â”‚ â”œâ”€ Directory                           â”‚
â”‚ â”‚  â””â”€ "." (current directory)          â”‚
â”‚ â”‚                                       â”‚
â”‚ â””â”€ Verbosity                           â”‚
â”‚    â””â”€ True/False (debug output)        â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Legend:**
- `â”‚` - Sequential flow
- `â”Œâ”€â”` - Component boundary
- `â—„â”€â”€â”` - Feedback loop
- `â”â”â”“` - Input/Output
- `â–¼` - Data flow direction

